<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="description" content="iRO2 Server Status">

		<title>Status</title>

		<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

		<style>
			#status .online strong { color: #090; }
			#status .offline strong { color: #900; }
			#status .unknown strong { color: #999; }
			#status ul { list-style: none; padding: 0; }
		</style>
	</head>

	<body id="status">
		<h3>iRO2 Server Status</h3>
		<p>Status is auto-updated every {{ ttl }} seconds.</p>
		<ul id="status-ajax">
			<li>Loading...</li>
		</ul>
		<script>
			$(document).ready(function() {
				(function refresh() {
					$.ajax({
						type: "POST",
						dataType: "json",
						url: "/",
						success: function(data) {
							/* Empty the unordered list */
							$("#status-ajax").empty();
							console.log("Objects =", data);
							/* Loop through the API objects */
							for (var d in data) {
								/* Create a list item node */
								var list_node = document.createElement('li');
								list_node.id = data[d].Name;
								list_node.className = data[d].Status;
								var list_text = document.createTextNode(data[d].Name + ' is ');
								list_node.appendChild(list_text);
								/* Create a status node */
								var status_node = document.createElement('strong');
								var status_text = document.createTextNode(data[d].Status);
								status_node.appendChild(status_text);
								/* Append a status to a list */
								list_node.appendChild(status_node);
								/* Append a list item to the unordered list */
								document.getElementById("status-ajax").appendChild(list_node);
							}
						},
						complete: function() {
							var now = new Date();
							console.info(now.toLocaleString());
							setTimeout(refresh, 10000);
						}
					});
				})();
			});
		</script>
	</body>
</html>
